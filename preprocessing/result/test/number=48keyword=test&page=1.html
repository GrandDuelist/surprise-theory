the acid doc close assertequ doc childnod length wrong number of children in docum first assertequ doc firstchild name touppercas html name wrong first chang to add touppercas for html compat assertequ doc firstchild publicid w3c dtd html transition en publicid wrong first if doc firstchild systemid null doc firstchild systemid fail systemid wrong first if internalsubset in doc firstchild doc firstchild internalsubset assertequ doc firstchild internalsubset null internalsubset wrong first assertequ doc documentel childnod length wrong number of children in html first assertequ doc documentel firstchild nodenam head misplac head elem first assertequ doc documentel firstchild childnod length wrong number of children in head first assertequ doc documentel firstchild firstchild tagnam titl misplac titl elem first assertequ doc documentel lastchild nodenam bodi misplac bodi elem first assertequ doc documentel lastchild childnod length wrong number of children in bodi first assertequ doc documentel lastchild firstchild tagnam span misplac span elem first assertequ doc documentel lastchild lastchild tagnam script misplac script elem first parent child doc doc write doc close assertequ doc childnod length wrong number of children in docum second assertequ doc firstchild name touppercas html name wrong second chang to add touppercas for html compat assertequ doc firstchild publicid w3c dtd html transition en publicid wrong second assertequ doc firstchild systemid systemid wrong second if internalsubset in doc firstchild doc firstchild internalsubset assertequ doc firstchild internalsubset null internalsubset wrong second assertequ doc documentel childnod length wrong number of children in html second assertequ doc documentel firstchild nodenam head misplac head elem second assertequ doc documentel firstchild childnod length wrong number of children in head second assertequ doc documentel firstchild firstchild tagnam titl misplac titl elem second assertequ doc documentel lastchild nodenam bodi misplac bodi elem second assertequ doc documentel lastchild childnod length wrong number of children in bodi second assertequ doc documentel lastchild firstchild tagnam span misplac span elem second assertequ doc documentel lastchild firstchild firstchild tagnam script misplac script elem second final prepar the file for the next doc doc write doc close return function dynam modif of block text node from jona sick and garret smith var doc kungfudeathgrip childnod contentdocu assert doc miss docum for assert doc imag prerequisit fail no imag assertequ doc imag height prerequisit fail style didn t affect imag doc stylesheet ownernod firstchild data img height px assertequ doc imag height chang fail to take effect doc stylesheet ownernod appendchild doc createtextnod img height px assertequ doc imag height append fail to take effect var rule doc stylesheet cssrule all css object in the dom ar live sai section overview of the dom level css interfac doc stylesheet insertrul img height px assertequ doc imag height insertrul fail to take effect assertequ doc stylesheet cssrule length count of rule i wrong assertequ rule length cssrule isn t live while we re at it some other thing doc stylesheet assert doc stylesheet href null intern stylesheet had a uri doc stylesheet href assert docum stylesheet href null intern acid stylesheet had a uri docum stylesheet href return function nest event from jona sick var doc kungfudeathgrip childnod contentdocu impli event var up var down var doc createel type onclick function up if up referenc an svg docum if ifram getsvgdocu fail getsvgdocu miss elem assert ifram getsvgdocu getsvgdocu fail for referenc an svg docum assert ifram getsvgdocu ifram contentdocu mismatch between getsvgdocu and contentdocu object var object kungfudeathgrip childnod assert object fail find svg object assert object contentdocu contentdocu fail for referenc an svg docum if object getsvgdocu fail getsvgdocu miss elem assert object getsvgdocu getsvgdocu fail for referenc an svg docum assert object getsvgdocu object contentdocu mismatch between getsvgdocu and contentdocu return function part comment out for updat svg font svg smil anim and xlink have met with some implementor malais even amongst those that ship them thi affect test to smil in svg from erik dahlstrom the begin by creat a few elem among those i a elem thi elem i prevent from run by set begin indefinit which mean that the anim doesn t until the beginel dom method i call the elem the anim i a simpl anim that set the valu of the width attribut to the durat of the anim i indefinit which mean that the valu will stai indefinit the target of the anim i the width attribut of the elem that i the parent of the elem when width i the rect i not render accord to the spec some properti of the svganimatedlength and svglength ar also inspect befor the anim start both basev and animv contain the same valu then the anim i start by call the beginel method to make sure that time pass between the trigger of the anim and the time that the valu ar read out in the current time i set to second us the setcurrenttim method var svgn var svgdoc kungfudeathgrip firstchild contentdocu assert svgdoc contentdocu fail for svg docum var svg svgdoc documentel var rect svgdoc createelementn svgn rect rect setattribut fill red rect setattribut width rect setattribut height rect setattribut id rect var anim svgdoc createelementn svgn set anim setattribut begin indefinit anim setattribut to anim setattribut attributenam width anim setattribut dur indefinit anim setattribut fill freez rect appendchild anim svg appendchild rect assert rect width svg dom interfac svgrectel not support assert rect width basev svg dom base type svganimatedlength not support assert rect width animv svg dom base type svganimatedlength not support assertequ svglength svg_lengthtype_number incorrect svglength svg_lengthtype_number constant valu assertequ rect width basev unittyp svglength svg_lengthtype_number incorrect unittyp width attribut assertequ rect getattribut width incorrect valu from getattribut assertequ rect width basev valueinspecifiedunit incorrect valueinspecifiedunit valu assertequ rect width basev valu incorrect basev valu befor anim assertequ rect width animv valu incorrect animv valu befor anim anim beginel assertequ rect width basev valu incorrect basev valu after start anim svg setcurrenttim set second to make sure that time s when we the animv valu the anim i then test in the next return function smil in svg part from erik dahlstrom about animv if the given attribut or properti i be anim contain the current anim valu of the attribut or properti and both the object itself and it content ar readonli if the given attribut or properti i not current be anim contain the same valu a basev sinc the durat of the anim i indefinit the valu i still be anim at the time it s queri now sinc the width attribut wa anim from it origin valu of to the new valu of the animv properti must contain the valu var svgdoc kungfudeathgrip firstchild contentdocu assert svgdoc contentdocu fail for svg docum var rect svgdoc getelementbyid rect assert rect fail to find elem in svg docum assertequ rect width animv valu incorrect animv valu after svg anim return function extern svg font from erik dahlstrom svgfont ar describ here and the relev dom method us in the ar defin here note that in order to be more predict the svg should be visibl so that claus for non render environ the user agent shall make reason assumpt about glyph metric doesn t influenc the result we us opac to hide the svg but arguabl it s still a render environ the font size wa chosen becaus that match the unitsperem valu in the svgfont which make it easi to the glyph advanc sinc thei will then be exactli what wa specifi in the svgfont var svgn var xlinkn var svgdoc kungfudeathgrip firstchild contentdocu assert svgdoc contentdocu fail for svg docum var svg svgdoc documentel var text svgdoc createelementn svgn text text setattribut y em text setattribut font size text setattribut font famili acid3svgfont var textcont svgdoc createtextnod abc text appendchild textcont svg appendchild text the font size wa chosen becaus that match the unitsperem valu in the svgfont which make it easi to the glyph advanc sinc thei will then be exactli what wa specifi in the svgfont assert text getnumberofchar svgtextcontentel getnumberofchar not support assertequ text getnumberofchar getnumberofchar return incorrect string length assertequ text getcomputedtextlength getcomputedtextlength fail assertequ text getsubstringlength getsubstringlength fail assertequ text getsubstringlength getsubstringlength fail assertequ text getsubstringlength getsubstringlength fail assertequ text getsubstringlength getsubstringlength fail comment out becaus svgwg keep chang thi var code try var sl text getsubstringlength catch e code e code assertequ code domexcept index_size_err getsubstringlength didn t throw except code try var sl text getsubstringlength catch e code e code assertequ code domexcept index_size_err getsubstringlength didn t throw except code try var sl text getsubstringlength catch e code e code assertequ code domexcept index_size_err getsubstringlength didn t throw except code try var sl text getsubstringlength catch e code neg valu might throw nativ except sinc the api accept onli unsign valu assert code getsubstringlength didn t throw except assertequ text getstartpositionofchar x getstartpositionofchar x return invalid valu assertequ text getstartpositionofchar x getstartpositionofchar x return invalid valu assertequ text getstartpositionofchar x getstartpositionofchar x return invalid valu assertequ text getstartpositionofchar y getstartpositionofchar y return invalid valu code try var val text getstartpositionofchar catch e code neg valu might throw nativ except sinc the api accept onli unsign valu assert code getstartpositionofchar except fail code try var val text getstartpositionofchar catch e code e code assertequ code domexcept index_size_err getstartpositionofchar except fail assertequ text getendpositionofchar x getendpositionofchar x return invalid valu assertequ text getendpositionofchar x getendpositionofchar x return invalid valu assertequ text getendpositionofchar x getendpositionofchar x return invalid valu code try var val text getendpositionofchar catch e code neg valu might throw nativ except sinc the api accept onli unsign valu assert code getendpositionofchar except fail code try var val text getendpositionofchar catch e code e code assertequ code domexcept index_size_err getendpositionofchar except fail return function svg textpath and getrotationofchar from erik dahlstrom the getrotationofchar method fetch the midpoint rotat of a glyph defin by a charact in thi testcas there i a simpl correspond between the two the path i defin in the svg xml file and consist of first a line go down then follow by a line that ha a degre slope and then follow by a horizont line the length of each path segment have been pair with the advanc of each glyph so that each glyph will be each of the three differ path segment see text a path layout rule thu the rotat of the first glyph i degre the second degre and the third degre var svgn var xlinkn var svgdoc kungfudeathgrip firstchild contentdocu assert svgdoc contentdocu fail for svg docum var svg svgdoc documentel var text svgdoc createelementn svgn text text setattribut font size text setattribut font famili acid3svgfont var textpath svgdoc createelementn svgn textpath textpath setattributen xlinkn xlink href path var textcont svgdoc createtextnod abc textpath appendchild textcont text appendchild textpath svg appendchild text assertequ text getrotationofchar getrotationofchar fail assertequ text getrotationofchar getrotationofchar fail assertequ text getrotationofchar getrotationofchar fail var code try var val text getrotationofchar catch e code e code assertequ code domexcept index_size_err getrotationofchar except fail code try var val text getrotationofchar catch e code e code assertequ code domexcept index_size_err getrotationofchar except fail return function a giant for from cameron mccormack thi test variou featur of svg font from svg it consist of a elem with charact style us an svg font that ha differ advanc valu for each glyph the script us svgtextelementcont getstartpositionofchar to determin where the glyph correspond to each charact wa place and thu to work out whether the svg font wa us correctli the font us unit per em and the text i set in px sinc font size give the size of the em the scale of the coordin system for the glyph i the same a the svg docum the expectedadv arrai hold the expect advanc valu for each charact and expectedkern hold the neg kern for each charact getpositionofchar return the actual x coordin for the glyph correspond to the given charact and if multipl charact correspond to the same glyph the same position valu i return for each of those charact here ar the reason for the advanc kern valu note that for a given charact at index i the expect position i sum expectedadv i expectedkern i char advanc kern reason a normal charact map to a singl glyph b first charact of a two charact glyph so the current position isn t advanc until the second charact c second charact of a two charact glyph so now the position i advanc b although there i a glyph for bc in the font it appear after the glyph for b so the singl charact glyph for b should be chosen instead d normal charact map to a singl glyph a kern of i specifi in the font between the a and ee glyph e the first charact of a two charact glyph ee e the second charact of a two charact glyph u thi i a glyph for the six charact u which happen to look like a valid unicod rang thi test that the in the font match exact string rather than a rang a us in the kern elem second charact of six charact glyph third charact of six charact glyph fourth charact of six charact glyph fifth charact of six charact glyph sixth charact of six charact glyph u the same six charact glyph that look like a unicod rang on of the kern elem ha u u u u which shouldn t match thi becaus those attribut ar interpret a unicod rang if thei ar and normal string otherw thu there should be no kern between these two glyph g kern i between thi charact and the next g sinc there i an elem that us a unicod rang it u attribut and a glyph name it g attribut which both match g g normal charact with kern befor it h a glyph with graphic content describ the glyph rather than a d attribut i glyph ar check in docum order for on that match but the first glyph with unicod i also ha lang zh which disqualifi it thu the second glyph with unicod i i chosen i sinc thi i ha xml lang zh it in the text the first glyph with lang zh match j a normal glyph with kern between the j and the next glyph a equal to the advanc of the j glyph so the position should stai the same a normal glyph with kern befor it k the first glyph with unicod k doe not match sinc it ha orient v so the second glyph with unicod k i chosen the space charact should the glyph with unicod despit it have a mislead glyph name l l the l charact should the glyph with unicod despit it have a mislead glyph name spacev a an elem i us to the glyph for u instead of the on for a u test glyph select with a non plane charact a a final normal charact in addition the script test the valu return by svgtextcontentel getnumberofchar which in thi case should be if it return then it incorrectli count unicod charact instead of utf codepoint probabl see for a descript of the glyph match rule and for a descript of getstartpositionofchar and getnumberofchar note also that the us domimplement createdocu to creat the svg docum thi seem to caus browser troubl for the svg dom interfac sinc the docum isn t be render a it might be if it were in an chang the to us an will at least let you see the main part of the run var n svg xml xlink var doc kungfudeathgrip childnod contentdocu while doc haschildnod doc removechild doc firstchild doc appendchild doc createelementn n svg svg svg var e function n a c var elt doc createelementn n svg n if a for var an in a var idx an indexof var n null if idx n n an substr idx elt setattributen n an a an if c for var i in c var c c i elt appendchild typeof c string doc createtextnod c c return elt doc documentel appendchild e font horiz adv x e font face font famili hcl unit per em ascent descent e miss glyph null e path d m h v h z e glyph unicod a d m h v h z e glyph unicod bc d m h v h z horiz adv x e glyph unicod b d m h v h z horiz adv x e glyph unicod c d m h v h z horiz adv x e glyph unicod bd d m h v h z horiz adv x e glyph unicod d d m h v h z horiz adv x e glyph unicod ee d m h v h z horiz adv x glyph name grapefruit e glyph unicod u d m h v h z horiz adv x e glyph unicod f d m h v h z horiz adv x e glyph unicod g d m h v h z horiz adv x glyph name gee e glyph unicod ud udc d m h v h z horiz adv x id astral e glyph unicod h horiz adv x e path d m h v h z e glyph unicod i d m h v h z horiz adv x lang zh e glyph unicod i d m h v h z horiz adv x e glyph unicod j d m h v h z horiz adv x e glyph unicod k d m h v h z horiz adv x orient v e glyph unicod k d m h v h z horiz adv x e glyph unicod d m h v h z horiz adv x glyph name l e glyph unicod l d m h v h z horiz adv x glyph name space e hkern u a u ee k e hkern u a g grapefruit k e hkern u u u u k e hkern u u g gee k e hkern u j u a k doc documentel appendchild e text y font famili hcl font size px letter space px word space px abcbdaeeu+0046u+0046gghi e tspan xml lang zh i jak l e altglyph xlink href astral a ud udc85a var t doc documentel lastchild var characterdescript a normal charact the first charact of a two charact glyph the second charact of a two charact glyph a normal charact which shouldn t be the first charact of a two charact glyph a normal charact which shouldn t be the second charact of a two charact glyph a normal charact which ha some kern after it the first charact of a two charact glyph which ha some kern befor it the second charact of a two charact glyph which ha some kern befor it the first charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the second charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the third charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the fourth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the fifth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the sixth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern after it but thi glyph doe not the first charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not the second charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not the third charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not the fourth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not the fifth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not the sixth charact of a six charact glyph which happen to look like a unicod rang where the rang specifi glyph ha kern befor it but thi glyph doe not a normal charact which ha some kern after it that i specifi by glyph name a normal charact which ha some kern befor it that i specifi by glyph name a normal charact whose glyph i given by child graphic content of the elem a normal charact whose glyph should not match the on with a lang attribut it a normal charact whose glyph should match the on with a lang attribut it a normal charact which ha some kern after it that i equal to the advanc of the charact a normal charact which ha some kern befor it that i equal to the advanc of the previou charact a normal charact whose glyph should not match the on with an orient v attribut it a space charact which ha a mislead glyph name attribut a normal charact which ha a mislead glyph name attribut a normal charact whose glyph i chosen to be anoth by us a charact not in plane high surrog pair a charact not in plane low surrog pair a normal charact var expectedadv a bc bc b d a ee ee u u u u u u u u u u u u g g h i i zh j a k l a us altglyph high surrog pair low surrog pair a var expectedkern a bc bc b d a ee ee u u u u u u u u u u u u g g h i i zh j a k l a us altglyph high surrog pair low surrog pair a assertequ t getnumberofchar expectedadv length svgsvgtextel getnumberofchar incorrect var expectedposit for var i i b return return assertequ result length miss properti for var index index fp error log zeropaddedindex pass but took elapsedtest m less than fp n els fail no messag catch e var s if e messag s e messag replac s els s e error log zeropaddedindex fail s n retri index span firstchild data score settimeout updat delai els var endtim new date var elapsedtim endtim starttim delai test length log total elaps time elapsedtim tofix s if error log nno j error and no time issu nwa the render pixel for pixel perfect too function report event for debug either the a in acid to get an alert or shift it to get a report if event shiftkei var w window w docum write fail test length score of test length test n log replac g replac regexp w docum close els alert fail test length score score s n log acid j to pass the a browser must us it default set the anim ha to be smooth the score ha to end and the final ha to look exactli pixel for pixel like thi refer render script must be enabl to us thi 